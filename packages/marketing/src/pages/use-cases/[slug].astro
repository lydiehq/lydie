---
import Layout from "../../layouts/Layout.astro";
import Container from "../../components/Container.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import { Button } from "../../components/generic/Button";
import { ChevronRightRegular } from "@fluentui/react-icons";
import { FAQSection } from "src/components/tools/FAQSection";
import { GradientOutline } from "src/components/generic/GradientOutline";
import { DemoWithSelector } from "../../components/landing/DemoWithSelector";
import Divider from "src/components/landing/Divider.astro";
import "../../styles/grainy-gradient.css";
import { CTASection } from "src/components/landing/CTASection";
import { Heading } from "src/components/generic/Heading";
import { getUseCase, useCases, type UseCase } from "src/data/use-cases";
import { Eyebrow } from "src/components/landing/Eyebrow";
import TemplateThumbnail from "src/components/templates/TemplateThumbnail.astro";
import { SectionHeader } from "src/components/landing/SectionHeader";
import { getTemplate } from "src/data/templates";

export function getStaticPaths() {
  return useCases.map((useCase) => ({
    params: { slug: useCase.slug },
  }));
}

const { slug } = Astro.params;
const useCase: UseCase | undefined = getUseCase(slug!);

if (!useCase) {
  return Astro.redirect("/404");
}

const {
  metaTitle,
  metaDescription,
  title,
  description,
  content,
  faqs,
  demoStates,
  ctaText,
  templateSlugs,
} = useCase;

// Fetch templates for this use case
const templates = templateSlugs
  ? await Promise.all(templateSlugs.map((slug: string) => getTemplate(slug)))
  : [];
const validTemplates = templates.filter((t): t is NonNullable<typeof t> => t !== undefined);
---

<Layout title={metaTitle} description={metaDescription}>
  <Container
    className="flex flex-col items-center justify-center min-h-[60vh] py-8 gap-y-12"
  >
    <div class="w-full">
      <Breadcrumbs
        items={[{ label: "Use cases", href: "/use-cases" }, { label: title }]}
      />
    </div>
    <div class="text-center relative py-8 size-full">
      <div
        class="flex flex-col max-w-md mx-auto text-center items-center gap-y-6"
      >
        <Heading className="text-4xl">
          {metaTitle.replace(" - Lydie", "")}
        </Heading>
        <p class="text-base text-black/60 mx-auto text-balance">
          {description}
        </p>
        <div class="flex items-center justify-center gap-4">
          <Button href="https://app.lydie.co/auth" size="lg" intent="primary">
            <span>{ctaText}</span>
            <ChevronRightRegular className="size-4" />
          </Button>
        </div>
      </div>
    </div>
    <DemoWithSelector
      client:load
      states={demoStates}
      initialState={demoStates[0]}
    />
    <div class="max-w-xl mx-auto flex flex-col gap-y-8">
      <div class="prose mx-auto">
        {
          content.map((paragraph: string, index: number) => (
            <p
              class="fade-in-element"
              style={`animation-delay: ${0.4 + index * 0.1}s;`}
            >
              {paragraph}
            </p>
          ))
        }
      </div>
    </div>
    <Divider />
    <section class="flex flex-col md:flex-row gap-8 w-full">
      <SectionHeader
        title="Templates"
        description="Here are some templates that you can use to get started with Lydie."
        className="max-w-sm"
      />
      <div class="grid grid-cols-1 gap-4 md:grid-cols-3 grow">
        {
          validTemplates.length > 0 ? (
            validTemplates.map((template: { name: string; teaser: string; slug: string; thumbnailSrc: string | null; }) => (
              <TemplateThumbnail
                name={template.name}
                teaser={template.teaser}
                href={`/templates/${template.slug}`}
                slug={template.slug}
                thumbnailSrc={template.thumbnailSrc}
              />
            ))
          ) : (
            <p class="text-gray-500 col-span-3">No templates available for this use case.</p>
          )
        }
      </div>
    </section>
    <Divider />
    <div class="max-w-xl mx-auto">
      <FAQSection faqs={faqs} client:load />
    </div>
  </Container>
  <CTASection client:load />
</Layout>

<style>
  @keyframes fade-in-up {
    0% {
      opacity: 0;
      transform: translateY(10px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .fade-in-element {
    animation: fade-in-up 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    opacity: 0;
  }
</style>
